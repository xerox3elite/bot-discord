"""
‚öôÔ∏è Arsenal Configuration System
Syst√®me de configuration complet avec menus d√©roulants comme DraftBot
D√©velopp√© par XeRoX - Arsenal Bot V4.5
"""

import discord
from discord.ext import commands
from discord import app_commands
import json
import os
from typing import Optional, Dict, Any
import datetime

# Import de la vue de configuration des salons temporaires
try:
    from modules.tempchannels_manager import TempChannelsConfigView
    from config_views.interactive_config import EconomyConfigView, LevelingConfigView
except ImportError:
    # Si les modules ne sont pas encore charg√©s, cr√©er des classes temporaires
    class TempChannelsConfigView:
        def __init__(self, config, guild_id):
            pass
    
    class EconomyConfigView:
        def __init__(self, config, guild_id):
            pass
    
    class LevelingConfigView:
        def __init__(self, config, guild_id):
            pass

class ConfigurationSelect(discord.ui.Select):
    def __init__(self):
        options = [
            discord.SelectOption(
                label="üí∞ Syst√®me d'√âconomie",
                value="economy",
                description="Configuration ArsenalCoin, r√©compenses, shop",
                emoji="üí∞"
            ),
            discord.SelectOption(
                label="üìä Syst√®me de Logs",
                value="logs",
                description="Logs de mod√©ration, messages, vocaux",
                emoji="üìä"
            ),
            discord.SelectOption(
                label="üõ°Ô∏è AutoMod",
                value="automod",
                description="Anti-spam, anti-liens, filtres de mots",
                emoji="üõ°Ô∏è"
            ),
            discord.SelectOption(
                label="üîä Salons Temporaires",
                value="tempchannels",
                description="Salons vocaux temporaires automatiques",
                emoji="üîä"
            ),
            discord.SelectOption(
                label="üéµ Syst√®me Musical",
                value="music",
                description="Configuration du bot musical",
                emoji="üéµ"
            ),
            discord.SelectOption(
                label="üéüÔ∏è Syst√®me de Tickets",
                value="tickets",
                description="Support, r√©clamations, tickets priv√©s",
                emoji="üéüÔ∏è"
            ),
            discord.SelectOption(
                label="üìù Sondages & Annonces",
                value="polls",
                description="Configuration des sondages et annonces",
                emoji="üìù"
            ),
            discord.SelectOption(
                label="‚≠ê R√¥les de R√©action",
                value="reaction_roles",
                description="Attribution automatique de r√¥les",
                emoji="‚≠ê"
            ),
            discord.SelectOption(
                label="üëã Accueil & D√©part",
                value="welcome",
                description="Messages d'accueil et r√¥les automatiques",
                emoji="üëã"
            ),
            discord.SelectOption(
                label="üéÆ Hunt Royal",
                value="hunt_royal",
                description="Configuration Hunt Royal et gaming",
                emoji="üéÆ"
            ),
            discord.SelectOption(
                label="üèÜ Syst√®me de Niveaux",
                value="leveling",
                description="XP, niveaux, r√©compenses de niveau",
                emoji="üèÜ"
            ),
            discord.SelectOption(
                label="üí≥ Crypto & Wallets",
                value="crypto",
                description="Portefeuilles crypto et transactions",
                emoji="üí≥"
            )
        ]
        super().__init__(
            placeholder="üîß S√©lectionnez un syst√®me √† configurer...",
            min_values=1,
            max_values=1,
            options=options
        )

    async def callback(self, interaction: discord.Interaction):
        system = self.values[0]
        await interaction.response.defer()
        
        # Charger la configuration selon le syst√®me s√©lectionn√©
        config_handler = ArsenalConfigSystem(interaction.client)
        await config_handler.handle_system_config(interaction, system)

class ArsenalConfigSystem(commands.Cog):
    def __init__(self, bot):
        self.bot = bot
        self.config_path = "data/config"
        os.makedirs(self.config_path, exist_ok=True)

    def load_config(self, guild_id: int, system: str) -> Dict[str, Any]:
        """Charge la configuration d'un syst√®me"""
        config_file = f"{self.config_path}/{guild_id}_{system}.json"
        try:
            with open(config_file, 'r', encoding='utf-8') as f:
                return json.load(f)
        except:
            return self.get_default_config(system)

    def save_config(self, guild_id: int, system: str, config: Dict[str, Any]):
        """Sauvegarde la configuration d'un syst√®me"""
        config_file = f"{self.config_path}/{guild_id}_{system}.json"
        with open(config_file, 'w', encoding='utf-8') as f:
            json.dump(config, f, ensure_ascii=False, indent=2)

    def get_default_config(self, system: str) -> Dict[str, Any]:
        """Retourne la configuration par d√©faut pour un syst√®me"""
        defaults = {
            "economy": {
                "enabled": True,
                "daily_reward": 1000,
                "max_daily_streak": 30,
                "shop_enabled": True,
                "transfer_enabled": True,
                "currency_name": "ArsenalCoin",
                "currency_symbol": "AC"
            },
            "logs": {
                "enabled": False,
                "message_logs": {"enabled": False, "channel": None},
                "mod_logs": {"enabled": False, "channel": None},
                "voice_logs": {"enabled": False, "channel": None},
                "join_leave": {"enabled": False, "channel": None},
                "role_logs": {"enabled": False, "channel": None}
            },
            "automod": {
                "enabled": False,
                "anti_spam": {"enabled": False, "max_messages": 5, "time_window": 10},
                "anti_links": {"enabled": False, "whitelist": []},
                "word_filter": {"enabled": False, "blacklist": []},
                "anti_caps": {"enabled": False, "threshold": 70},
                "auto_timeout": {"enabled": False, "duration": 300}
            },
            "tempchannels": {
                "enabled": False,
                "category_id": None,
                "template_name": "{user}'s Channel",
                "user_limit": 10,
                "auto_delete": True
            },
            "music": {
                "enabled": True,
                "max_volume": 100,
                "default_volume": 50,
                "queue_limit": 100,
                "dj_role": None
            },
            "tickets": {
                "enabled": False,
                "category_id": None,
                "support_role": None,
                "auto_close": 24,
                "transcript_channel": None
            },
            "polls": {
                "enabled": True,
                "default_duration": 3600,
                "anonymous_allowed": True,
                "max_options": 10
            },
            "reaction_roles": {
                "enabled": False,
                "messages": {}
            },
            "welcome": {
                "enabled": False,
                "welcome_channel": None,
                "goodbye_channel": None,
                "welcome_message": "Bienvenue {user} sur **{server}** !",
                "goodbye_message": "Au revoir {user}... üëã",
                "auto_role": None
            },
            "hunt_royal": {
                "enabled": True,
                "api_key": None,
                "auto_updates": True,
                "leaderboard_channel": None
            },
            "leveling": {
                "enabled": False,
                "xp_per_message": {"min": 15, "max": 25},
                "xp_cooldown": 60,
                "level_up_message": True,
                "level_up_channel": None,
                "role_rewards": {}
            },
            "crypto": {
                "enabled": False,
                "supported_currencies": ["BTC", "ETH", "BNB"],
                "alerts_channel": None,
                "portfolio_tracking": True
            }
        }
        return defaults.get(system, {})

    @app_commands.command(name="config", description="‚öôÔ∏è Configuration compl√®te d'Arsenal Bot")
    async def config_command(self, interaction: discord.Interaction):
        """Commande principale de configuration"""
        # V√©rifier les permissions
        if not interaction.user.guild_permissions.administrator:
            embed = discord.Embed(
                title="‚ùå Permissions Insuffisantes",
                description="Cette commande n√©cessite les permissions d'administrateur.",
                color=0xff6b6b
            )
            await interaction.response.send_message(embed=embed, ephemeral=True)
            return

        guild = interaction.guild
        
        embed = discord.Embed(
            title="‚öôÔ∏è Configuration Arsenal Bot",
            description="Bienvenue dans la commande de configuration d'**Arsenal Bot**.\n"
                       "Gr√¢ce √† cette commande, vous pourrez configurer les diff√©rents syst√®mes "
                       "propos√©s dans le s√©lecteur que vous trouverez ci-dessous.",
            color=0x00ff88,
            timestamp=datetime.datetime.now()
        )

        embed.add_field(
            name="üìã Param√®tres de Base",
            value=f"**Serveur :** {guild.name}\n"
                  f"**Membres :** {guild.member_count:,}\n"
                  f"**ID Serveur :** `{guild.id}`\n"
                  f"**R√©gion :** {guild.preferred_locale or 'Fran√ßais'}",
            inline=False
        )

        embed.add_field(
            name="üöÄ Pour Simplifier la Configuration",
            value="‚Ä¢ Utilisez le **WebPanel Arsenal** pour une interface graphique\n"
                  "‚Ä¢ Consultez la **documentation Arsenal** sur GitHub\n"
                  "‚Ä¢ Le **support Arsenal** est disponible pour vous aider\n"
                  "‚Ä¢ Toutes les configurations sont **sauvegard√©es automatiquement**",
            inline=False
        )

        embed.add_field(
            name="üí° Syst√®mes Disponibles",
            value="**12 syst√®mes** de configuration disponibles incluant :\n"
                  "üí∞ √âconomie ‚Ä¢ üìä Logs ‚Ä¢ üõ°Ô∏è AutoMod ‚Ä¢ üîä Vocal ‚Ä¢ üéµ Musique\n"
                  "üéüÔ∏è Tickets ‚Ä¢ üìù Sondages ‚Ä¢ ‚≠ê R√¥les ‚Ä¢ üëã Accueil ‚Ä¢ üéÆ Gaming\n"
                  "üèÜ Niveaux ‚Ä¢ üí≥ Crypto",
            inline=False
        )

        embed.set_thumbnail(url=guild.icon.url if guild.icon else self.bot.user.display_avatar.url)
        embed.set_footer(
            text="Arsenal Configuration System ‚Ä¢ Bot N¬∞1 Fran√ßais All-in-One",
            icon_url=self.bot.user.display_avatar.url
        )

        # Cr√©er la vue avec le s√©lecteur
        view = ConfigView()
        
        await interaction.response.send_message(embed=embed, view=view, ephemeral=True)

    async def handle_system_config(self, interaction: discord.Interaction, system: str):
        """G√®re la configuration d'un syst√®me sp√©cifique"""
        guild_id = interaction.guild_id
        config = self.load_config(guild_id, system)
        
        # Cr√©er l'embed de configuration selon le syst√®me
        if system == "economy":
            await self.config_economy(interaction, config)
        elif system == "logs":
            await self.config_logs(interaction, config)
        elif system == "automod":
            await self.config_automod(interaction, config)
        elif system == "tempchannels":
            await self.config_tempchannels(interaction, config)
        elif system == "music":
            await self.config_music(interaction, config)
        elif system == "tickets":
            await self.config_tickets(interaction, config)
        elif system == "polls":
            await self.config_polls(interaction, config)
        elif system == "reaction_roles":
            await self.config_reaction_roles(interaction, config)
        elif system == "welcome":
            await self.config_welcome(interaction, config)
        elif system == "hunt_royal":
            await self.config_hunt_royal(interaction, config)
        elif system == "leveling":
            await self.config_leveling(interaction, config)
        elif system == "crypto":
            await self.config_crypto(interaction, config)

    async def config_economy(self, interaction: discord.Interaction, config: Dict[str, Any]):
        """Configuration du syst√®me d'√©conomie"""
        embed = discord.Embed(
            title="üí∞ Configuration - Syst√®me d'√âconomie",
            description="Configurez le syst√®me ArsenalCoin et la boutique",
            color=0xffd700,
            timestamp=datetime.datetime.now()
        )

        status = "üü¢ Activ√©" if config.get("enabled", True) else "üî¥ D√©sactiv√©"
        embed.add_field(
            name="üìä √âtat Actuel",
            value=f"**Statut :** {status}\n"
                  f"**R√©compense Quotidienne :** {config.get('daily_reward', 1000):,} {config.get('currency_symbol', 'AC')}\n"
                  f"**S√©rie Maximum :** {config.get('max_daily_streak', 30)} jours\n"
                  f"**Boutique :** {'‚úÖ Active' if config.get('shop_enabled', True) else '‚ùå Inactive'}\n"
                  f"**Transferts :** {'‚úÖ Autoris√©s' if config.get('transfer_enabled', True) else '‚ùå Interdits'}",
            inline=False
        )

        embed.add_field(
            name="‚öôÔ∏è Param√®tres Disponibles",
            value="‚Ä¢ **Activer/D√©sactiver** le syst√®me\n"
                  "‚Ä¢ **Modifier** la r√©compense quotidienne\n"
                  "‚Ä¢ **Configurer** la boutique du serveur\n"
                  "‚Ä¢ **G√©rer** les transferts entre utilisateurs\n"
                  "‚Ä¢ **Personnaliser** le nom de la monnaie",
            inline=False
        )

        embed.add_field(
            name="üìà Statistiques",
            value="Utilisez `/balance` pour voir les statistiques d√©taill√©es",
            inline=False
        )

        view = EconomyConfigView(config, interaction.guild_id)
        await interaction.followup.send(embed=embed, view=view, ephemeral=True)

    async def config_logs(self, interaction: discord.Interaction, config: Dict[str, Any]):
        """Configuration du syst√®me de logs"""
        embed = discord.Embed(
            title="üìä Configuration - Syst√®me de Logs",
            description="Configurez les logs de mod√©ration et d'activit√©",
            color=0x3498db
        )

        logs_status = []
        for log_type, settings in config.items():
            if isinstance(settings, dict) and 'enabled' in settings:
                status = "üü¢" if settings['enabled'] else "üî¥"
                channel = f"<#{settings['channel']}>" if settings.get('channel') else "‚ùå Non d√©fini"
                logs_status.append(f"{status} **{log_type.replace('_', ' ').title()} :** {channel}")

        embed.add_field(
            name="üìã √âtat des Logs",
            value="\n".join(logs_status) if logs_status else "Aucun log configur√©",
            inline=False
        )

        view = LogsConfigView(config, interaction.guild_id)
        await interaction.followup.send(embed=embed, view=view, ephemeral=True)

    async def config_automod(self, interaction: discord.Interaction, config: Dict[str, Any]):
        """Configuration du syst√®me AutoMod"""
        embed = discord.Embed(
            title="üõ°Ô∏è Configuration - AutoMod",
            description="Configurez la mod√©ration automatique",
            color=0xe74c3c
        )

        automod_features = [
            ("Anti-Spam", config.get("anti_spam", {}).get("enabled", False)),
            ("Anti-Liens", config.get("anti_links", {}).get("enabled", False)),
            ("Filtre de Mots", config.get("word_filter", {}).get("enabled", False)),
            ("Anti-Majuscules", config.get("anti_caps", {}).get("enabled", False)),
            ("Timeout Automatique", config.get("auto_timeout", {}).get("enabled", False))
        ]

        status_text = "\n".join([
            f"{'üü¢' if enabled else 'üî¥'} **{feature}**" 
            for feature, enabled in automod_features
        ])

        embed.add_field(
            name="üõ°Ô∏è Fonctionnalit√©s AutoMod",
            value=status_text,
            inline=False
        )

        view = AutoModConfigView(config, interaction.guild_id)
        await interaction.followup.send(embed=embed, view=view, ephemeral=True)

class ConfigView(discord.ui.View):
    def __init__(self):
        super().__init__(timeout=300)
        self.add_item(ConfigurationSelect())

class EconomyConfigView(discord.ui.View):
    def __init__(self, config: Dict[str, Any], guild_id: int):
        super().__init__(timeout=300)
        self.config = config
        self.guild_id = guild_id

    @discord.ui.button(label="üîÑ Activer/D√©sactiver", style=discord.ButtonStyle.primary)
    async def toggle_economy(self, interaction: discord.Interaction, button: discord.ui.Button):
        self.config["enabled"] = not self.config.get("enabled", True)
        # Sauvegarder ici
        await interaction.response.send_message(
            f"üí∞ Syst√®me d'√©conomie {'activ√©' if self.config['enabled'] else 'd√©sactiv√©'} !",
            ephemeral=True
        )

class LogsConfigView(discord.ui.View):
    def __init__(self, config: Dict[str, Any], guild_id: int):
        super().__init__(timeout=300)
        self.config = config
        self.guild_id = guild_id

    @discord.ui.button(label="‚öôÔ∏è Configurer les Logs", style=discord.ButtonStyle.secondary)
    async def configure_logs(self, interaction: discord.Interaction, button: discord.ui.Button):
        await interaction.response.send_message("üîß Configuration des logs en cours de d√©veloppement...", ephemeral=True)

class AutoModConfigView(discord.ui.View):
    def __init__(self, config: Dict[str, Any], guild_id: int):
        super().__init__(timeout=300)
        self.config = config
        self.guild_id = guild_id

    @discord.ui.button(label="üõ°Ô∏è Configurer AutoMod", style=discord.ButtonStyle.danger)
    async def configure_automod(self, interaction: discord.Interaction, button: discord.ui.Button):
        await interaction.response.send_message("üõ°Ô∏è Configuration AutoMod en cours de d√©veloppement...", ephemeral=True)

# Ajout des commandes manquantes

@app_commands.command(name="poll", description="üìä Cr√©er un sondage interactif")
@app_commands.describe(
    question="Question du sondage",
    options="Options s√©par√©es par des virgules (max 10)",
    duration="Dur√©e en minutes (d√©faut: 60)"
)
async def create_poll(interaction: discord.Interaction, question: str, options: str, duration: Optional[int] = 60):
    """Cr√©er un sondage"""
    option_list = [opt.strip() for opt in options.split(',')]
    
    if len(option_list) < 2:
        await interaction.response.send_message("‚ùå Il faut au moins 2 options pour un sondage!", ephemeral=True)
        return
    
    if len(option_list) > 10:
        await interaction.response.send_message("‚ùå Maximum 10 options par sondage!", ephemeral=True)
        return
    
    embed = discord.Embed(
        title="üìä Sondage",
        description=f"**{question}**",
        color=0x3498db,
        timestamp=datetime.datetime.now()
    )
    
    # √âmojis pour les r√©actions
    emojis = ['1Ô∏è‚É£', '2Ô∏è‚É£', '3Ô∏è‚É£', '4Ô∏è‚É£', '5Ô∏è‚É£', '6Ô∏è‚É£', '7Ô∏è‚É£', '8Ô∏è‚É£', '9Ô∏è‚É£', 'üîü']
    
    options_text = ""
    for i, option in enumerate(option_list):
        options_text += f"{emojis[i]} {option}\n"
    
    embed.add_field(name="üó≥Ô∏è Options", value=options_text, inline=False)
    embed.add_field(name="‚è±Ô∏è Dur√©e", value=f"{duration} minutes", inline=True)
    embed.add_field(name="üë§ Cr√©ateur", value=interaction.user.mention, inline=True)
    
    embed.set_footer(text="Votez en r√©agissant avec les √©mojis correspondants!")
    
    await interaction.response.send_message(embed=embed)
    
    # Ajouter les r√©actions
    message = await interaction.original_response()
    for i in range(len(option_list)):
        await message.add_reaction(emojis[i])

@app_commands.command(name="suggest", description="üí° Faire une suggestion")
@app_commands.describe(suggestion="Votre suggestion")
async def suggest(interaction: discord.Interaction, suggestion: str):
    """Syst√®me de suggestions"""
    embed = discord.Embed(
        title="üí° Nouvelle Suggestion",
        description=suggestion,
        color=0xf39c12,
        timestamp=datetime.datetime.now()
    )
    
    embed.set_author(
        name=interaction.user.display_name,
        icon_url=interaction.user.display_avatar.url
    )
    
    embed.set_footer(text=f"ID: {interaction.user.id} ‚Ä¢ R√©agissez pour voter!")
    
    await interaction.response.send_message(embed=embed)
    
    # Ajouter les r√©actions de vote
    message = await interaction.original_response()
    await message.add_reaction("‚úÖ")  # Pour
    await message.add_reaction("‚ùå")  # Contre
    await message.add_reaction("ü§î")  # Neutre

@app_commands.command(name="level", description="üèÜ Voir votre niveau et XP")
@app_commands.describe(user="Utilisateur √† consulter")
async def level_command(interaction: discord.Interaction, user: Optional[discord.Member] = None):
    """Syst√®me de niveaux"""
    target = user or interaction.user
    
    # Donn√©es de test pour le moment
    level = 25
    xp = 12450
    xp_needed = 15000
    xp_progress = xp - (level * 500)  # XP dans le niveau actuel
    xp_for_next = 500  # XP n√©cessaire pour le niveau suivant
    
    embed = discord.Embed(
        title="üèÜ Syst√®me de Niveaux",
        color=0x9b59b6,
        timestamp=datetime.datetime.now()
    )
    
    embed.set_author(
        name=f"{target.display_name}",
        icon_url=target.display_avatar.url
    )
    
    embed.add_field(
        name="üìä Statistiques",
        value=f"**Niveau :** {level}\n"
              f"**XP Total :** {xp:,}\n"
              f"**Progression :** {xp_progress}/{xp_for_next} XP",
        inline=True
    )
    
    embed.add_field(
        name="üìà Classement",
        value=f"**Rang :** #7\n"
              f"**Percentile :** Top 15%\n"
              f"**Messages :** ~1,200",
        inline=True
    )
    
    # Barre de progression
    progress_bar_length = 20
    filled_length = int(progress_bar_length * xp_progress // xp_for_next)
    bar = "‚ñà" * filled_length + "‚ñë" * (progress_bar_length - filled_length)
    
    embed.add_field(
        name="üéØ Progression vers le niveau suivant",
        value=f"`{bar}` {(xp_progress/xp_for_next*100):.1f}%",
        inline=False
    )
    
    await interaction.response.send_message(embed=embed)

    async def config_tempchannels(self, interaction: discord.Interaction, config: Dict[str, Any]):
        """Configuration compl√®te du syst√®me de salons temporaires (comme DraftBot)"""
        embed = discord.Embed(
            title="üîä Configuration - Salons Vocaux Temporaires",
            description="Syst√®me complet de salons vocaux temporaires avec toutes les fonctionnalit√©s avanc√©es",
            color=0x00ffff,
            timestamp=datetime.datetime.now()
        )

        # Statut principal
        status = "üü¢ Activ√©" if config.get("enabled", False) else "üî¥ D√©sactiv√©"
        embed.add_field(
            name="üìä Statut Syst√®me",
            value=status,
            inline=True
        )

        # Canal g√©n√©rateur principal
        parent_channel = config.get("parent_channel_id")
        embed.add_field(
            name="üéØ Canal G√©n√©rateur",
            value=f"<#{parent_channel}>" if parent_channel else "‚ùå Non configur√©",
            inline=True
        )

        # Statistiques d'utilisation
        stats = config.get("stats", {})
        embed.add_field(
            name="üìà Statistiques",
            value=f"**Salons cr√©√©s :** `{stats.get('total_created', 0)}`\n"
                  f"**Actuellement actifs :** `{stats.get('currently_active', 0)}`\n"
                  f"**Moyenne dur√©e :** `{stats.get('avg_duration', '45min')}`",
            inline=True
        )

        # Configuration des permissions
        perms_config = config.get("permissions", {})
        embed.add_field(
            name="üîê Gestion des Permissions",
            value=f"**Cr√©ateur = Admin :** `{perms_config.get('creator_admin', 'Activ√©')}`\n"
                  f"**Invite uniquement :** `{perms_config.get('invite_only', 'D√©sactiv√©')}`\n"
                  f"**Transfert propri√©t√© :** `{perms_config.get('transfer_ownership', 'Activ√©')}`\n"
                  f"**Mod√©ration auto :** `{perms_config.get('auto_moderation', 'Activ√©')}`",
            inline=False
        )

        # Param√®tres de cr√©ation
        creation_config = config.get("creation", {})
        embed.add_field(
            name="‚öôÔ∏è Param√®tres de Cr√©ation",
            value=f"**Limite utilisateurs :** `{creation_config.get('default_limit', 10)} (max {creation_config.get('max_limit', 99)})`\n"
                  f"**Nom par d√©faut :** `{creation_config.get('default_name', 'Salon de {username}')}`\n"
                  f"**Bitrate :** `{creation_config.get('bitrate', 64)}kbps`\n"
                  f"**R√©gion vocale :** `{creation_config.get('voice_region', 'Automatique')}`",
            inline=True
        )

        # Auto-gestion
        auto_config = config.get("auto_management", {})
        embed.add_field(
            name="ü§ñ Gestion Automatique",
            value=f"**Suppression auto :** `{auto_config.get('auto_delete', 'Imm√©diate')}`\n"
                  f"**Nettoyage inactifs :** `{auto_config.get('cleanup_inactive', '5min')}`\n"
                  f"**Sauvegarde config :** `{auto_config.get('save_config', 'Activ√©e')}`\n"
                  f"**Logs cr√©ation :** `{auto_config.get('log_creation', 'Activ√©s')}`",
            inline=True
        )

        # Fonctionnalit√©s avanc√©es
        embed.add_field(
            name="‚ú® Fonctionnalit√©s Avanc√©es",
            value="üéõÔ∏è **Panel de contr√¥le int√©gr√©**\n"
                  "üë• **Gestion membres (kick/ban/mute)**\n"
                  "üîí **Verrouillage/D√©verrouillage**\n"
                  "üéµ **Contr√¥les de qualit√© audio**\n"
                  "üìù **Renommage √† la vol√©e**\n"
                  "‚è∞ **Programmation de suppression**\n"
                  "üéØ **Limites d'utilisateurs dynamiques**\n"
                  "üö´ **Liste noire/blanche d'utilisateurs**\n"
                  "üìä **Statistiques d√©taill√©es**\n"
                  "üîÑ **Clonage de salons**",
            inline=False
        )

        # Commandes disponibles  
        embed.add_field(
            name="üéÆ Commandes Propri√©taire",
            value="`ÔøΩ Verrouiller` - Verrouiller le salon\n"
                  "`üë• Limite` - Changer la limite d'utilisateurs\n" 
                  "`üìù Renommer` - Renommer le salon\n"
                  "`üëë Transf√©rer` - Donner la propri√©t√©\n"
                  "`üö´ Bannir` - Bannir un utilisateur\n"
                  "`‚ö° Expulser` - Expulser un utilisateur",
            inline=True
        )

        embed.add_field(
            name="üõ†Ô∏è Commandes Mod√©ration",
            value="`üìä Infos` - Informations du salon\n"
                  "`üóëÔ∏è Supprimer` - Supprimer le salon\n"
                  "`üîÑ Reset` - Reset permissions\n"
                  "`üìà Stats` - Statistiques d'usage\n"
                  "`üéµ Qualit√©` - R√©gler bitrate\n"
                  "`üìç R√©gion` - Changer r√©gion",
            inline=True
        )

        # Variables disponibles pour les noms
        embed.add_field(
            name="üìã Variables Nom (Personnalisation)",
            value="`{username}` - Nom du cr√©ateur\n"
                  "`{nickname}` - Pseudo sur le serveur\n"
                  "`{count}` - Nombre d'utilisateurs\n"
                  "`{game}` - Jeu en cours (si d√©tect√©)\n"
                  "`{time}` - Heure de cr√©ation\n"
                  "`{random}` - Nombre al√©atoire",
            inline=False
        )

        # Configuration des cat√©gories
        categories = config.get("categories", {})
        embed.add_field(
            name="üìÅ Gestion des Cat√©gories",
            value=f"**Cat√©gorie principale :** `{categories.get('main_category', 'Salons Temporaires')}`\n"
                  f"**Cat√©gorie d√©bordement :** `{categories.get('overflow_category', 'Auto-cr√©√©e')}`\n"
                  f"**Max par cat√©gorie :** `{categories.get('max_per_category', 50)}`\n"
                  f"**Organisation auto :** `{categories.get('auto_organize', 'Activ√©e')}`",
            inline=True
        )

        # Syst√®me de logs
        logs_config = config.get("logging", {})
        embed.add_field(
            name="üìù Syst√®me de Logs",
            value=f"**Canal logs :** `{logs_config.get('log_channel', 'Non d√©fini')}`\n"
                  f"**Log cr√©ations :** `{logs_config.get('log_creation', 'Activ√©')}`\n"
                  f"**Log suppressions :** `{logs_config.get('log_deletion', 'Activ√©')}`\n"
                  f"**Log permissions :** `{logs_config.get('log_permissions', 'Activ√©')}`",
            inline=True
        )

        # Cr√©er la view avec tous les boutons de configuration
        try:
            view = TempChannelsConfigView(config, interaction.guild_id)
            await interaction.followup.send(embed=embed, view=view, ephemeral=True)
        except Exception as e:
            # Fallback si la vue n'est pas disponible
            embed.add_field(
                name="‚öôÔ∏è Configuration Rapide",
                value="Utilisez les commandes suivantes pour configurer:\n"
                      "`/tempchannels-setup` - Configuration initiale\n"
                      "`/tempchannels-config` - Configuration avanc√©e\n"
                      "`/tempchannels-stats` - Voir les statistiques",
                inline=False
            )
            await interaction.followup.send(embed=embed, ephemeral=True)

    async def config_leveling(self, interaction: discord.Interaction, config: Dict[str, Any]):
        """Configuration du syst√®me de niveaux et XP"""
        embed = discord.Embed(
            title="üìà Configuration - Syst√®me de Niveaux",
            description="Configurez le syst√®me d'XP et de progression",
            color=0x9932cc,
            timestamp=datetime.datetime.now()
        )

        status = "üü¢ Activ√©" if config.get("enabled", True) else "üî¥ D√©sactiv√©"
        embed.add_field(
            name="üìä Statut",
            value=status,
            inline=True
        )

        embed.add_field(
            name="‚ö° Gains d'XP",
            value=f"**Par message :** `{config.get('xp_per_message', '15-25')} XP`\n"
                  f"**Cooldown :** `{config.get('xp_cooldown', 60)}s`\n"
                  f"**XP Vocal :** `{config.get('voice_xp', 1)} XP/min`",
            inline=True
        )

        embed.add_field(
            name="üèÜ R√©compenses",
            value=f"**R√¥les automatiques :** `{config.get('role_rewards', 'Activ√©s')}`\n"
                  f"**Annonces niveau :** `{config.get('level_announcements', 'Salon configur√©')}`\n"
                  f"**ArsenalCoin bonus :** `{config.get('coin_bonus', 'Activ√©')}`",
            inline=False
        )

        embed.add_field(
            name="üìã Fonctionnalit√©s",
            value="‚úÖ Syst√®me XP par messages\n"
                  "‚úÖ XP vocal en temps r√©el\n"
                  "‚úÖ Cartes de profil personnalis√©es\n" 
                  "‚úÖ Classement serveur\n"
                  "‚úÖ R√¥les de niveau automatiques\n"
                  "‚úÖ Multiplicateurs temporaires",
            inline=True
        )

        embed.add_field(
            name="üéÆ Commandes Disponibles", 
            value="`/level` - Voir son niveau\n"
                  "`/rank @user` - Niveau d'un membre\n"
                  "`/leaderboard xp` - Top XP serveur\n"
                  "`/profile` - Carte de profil",
            inline=True
        )

        embed.set_footer(text="Utilisez /config pour modifier ces param√®tres")
        await interaction.followup.send(embed=embed, ephemeral=True)

    async def config_crypto(self, interaction: discord.Interaction, config: Dict[str, Any]):
        """Configuration du syst√®me crypto trading"""
        embed = discord.Embed(
            title="‚Çø Configuration - Crypto Trading",
            description="Configurez le syst√®me de trading crypto",
            color=0xf7931a,
            timestamp=datetime.datetime.now()
        )

        status = "üü¢ Activ√©" if config.get("enabled", False) else "üî¥ D√©sactiv√©"
        embed.add_field(
            name="üìä Statut",
            value=status,
            inline=True
        )

        embed.add_field(
            name="üí± Cryptomonnaies",
            value=f"**Bitcoin (BTC) :** `{config.get('btc_enabled', 'Activ√©')}`\n"
                  f"**Ethereum (ETH) :** `{config.get('eth_enabled', 'Activ√©')}`\n"
                  f"**Binance Coin (BNB) :** `{config.get('bnb_enabled', 'Activ√©')}`",
            inline=True
        )

        embed.add_field(
            name="‚öôÔ∏è Param√®tres Trading",
            value=f"**Commission :** `{config.get('trading_fee', '0.1')}%`\n"
                  f"**Mise minimale :** `{config.get('min_trade', 10)} AC`\n"
                  f"**Limite quotidienne :** `{config.get('daily_limit', 1000)} AC`",
            inline=False
        )

        embed.add_field(
            name="üìã Fonctionnalit√©s",
            value="‚úÖ Prix en temps r√©el\n"
                  "‚úÖ Portefeuille crypto personnel\n"
                  "‚úÖ Historique des trades\n"
                  "‚úÖ Signaux de trading\n"
                  "‚úÖ Alertes de prix\n"
                  "‚úÖ Classement traders",
            inline=True
        )

        embed.add_field(
            name="üìà Commandes Trading",
            value="`/crypto buy` - Acheter crypto\n"
                  "`/crypto sell` - Vendre crypto\n"
                  "`/crypto portfolio` - Voir portefeuille\n"
                  "`/crypto price` - Prix actuels",
            inline=True
        )

        embed.set_footer(text="Utilisez /config pour modifier ces param√®tres")
        await interaction.followup.send(embed=embed, ephemeral=True)

    async def config_logs(self, interaction: discord.Interaction, config: Dict[str, Any]):
        """Configuration du syst√®me de logs"""
        embed = discord.Embed(
            title="üìù Configuration - Syst√®me de Logs",
            description="Configurez les logs du serveur",
            color=0x3498db,
            timestamp=datetime.datetime.now()
        )

        status = "üü¢ Activ√©" if config.get("enabled", True) else "üî¥ D√©sactiv√©"
        embed.add_field(
            name="üìä Statut",
            value=status,
            inline=True
        )

        embed.add_field(
            name="üìã Types de Logs",
            value="‚úÖ Messages supprim√©s/modifi√©s\n"
                  "‚úÖ Membres rejoints/quitt√©s\n"
                  "‚úÖ Sanctions (bans, kicks, mute)\n"
                  "‚úÖ R√¥les ajout√©s/supprim√©s\n"
                  "‚úÖ Salons cr√©√©s/supprim√©s\n"
                  "‚úÖ Voice activity (join/leave)",
            inline=True
        )

        log_channel = config.get("log_channel_id")
        embed.add_field(
            name="üìç Canal de Log",
            value=f"<#{log_channel}>" if log_channel else "‚ùå Non configur√©",
            inline=False
        )

        embed.set_footer(text="Utilisez /config pour modifier ces param√®tres")
        await interaction.followup.send(embed=embed, ephemeral=True)

    async def config_automod(self, interaction: discord.Interaction, config: Dict[str, Any]):
        """Configuration du syst√®me de mod√©ration automatique"""
        embed = discord.Embed(
            title="üõ°Ô∏è Configuration - AutoMod",
            description="Configurez la mod√©ration automatique",
            color=0xe74c3c,
            timestamp=datetime.datetime.now()
        )

        status = "üü¢ Activ√©" if config.get("enabled", True) else "üî¥ D√©sactiv√©"
        embed.add_field(
            name="üìä Statut",
            value=status,
            inline=True
        )

        embed.add_field(
            name="üõ°Ô∏è Protections Actives",
            value=f"**Anti-Spam :** `{config.get('anti_spam', 'Activ√©')}`\n"
                  f"**Anti-Liens :** `{config.get('anti_links', 'Activ√©')}`\n"
                  f"**Filtre Mots :** `{config.get('word_filter', 'Activ√©')}`\n"
                  f"**Anti-Caps :** `{config.get('anti_caps', 'Activ√©')}`\n"
                  f"**Auto-Timeout :** `{config.get('auto_timeout', '5min')}`",
            inline=True
        )

        embed.add_field(
            name="üìã Fonctionnalit√©s",
            value="‚úÖ D√©tection spam automatique\n"
                  "‚úÖ Blocage de liens suspects\n"
                  "‚úÖ Filtre de mots interdits\n"
                  "‚úÖ Limite de majuscules\n"
                  "‚úÖ Sanctions automatiques\n"
                  "‚úÖ Syst√®me d'avertissements",
            inline=False
        )

        embed.set_footer(text="Utilisez /config pour modifier ces param√®tres")
        await interaction.followup.send(embed=embed, ephemeral=True)

    async def config_music(self, interaction: discord.Interaction, config: Dict[str, Any]):
        """Configuration du syst√®me de musique"""
        embed = discord.Embed(
            title="üéµ Configuration - Syst√®me Musique",
            description="Configurez le lecteur de musique Arsenal",
            color=0x9b59b6,
            timestamp=datetime.datetime.now()
        )

        status = "üü¢ Activ√©" if config.get("enabled", True) else "üî¥ D√©sactiv√©"
        embed.add_field(
            name="üìä Statut",
            value=status,
            inline=True
        )

        embed.add_field(
            name="üéõÔ∏è Param√®tres Audio",
            value=f"**Volume par d√©faut :** `{config.get('default_volume', 50)}%`\n"
                  f"**Auto-Leave :** `{config.get('auto_leave', '5min')}`\n"
                  f"**Qualit√© :** `{config.get('audio_quality', 'Haute')}`\n"
                  f"**DJ-Only Mode :** `{config.get('dj_mode', 'D√©sactiv√©')}`",
            inline=True
        )

        embed.add_field(
            name="üéµ Sources Support√©es",
            value="‚úÖ YouTube (avec recherche)\n"
                  "‚úÖ Spotify (playlists)\n"
                  "‚úÖ SoundCloud\n"
                  "‚úÖ Fichiers directs (MP3, WAV)\n"
                  "‚úÖ Radio en ligne\n"
                  "‚úÖ Twitch streams",
            inline=False
        )

        embed.add_field(
            name="üéÆ Commandes Musique",
            value="`/play` - Jouer une musique\n"
                  "`/queue` - Voir la file d'attente\n"
                  "`/skip` - Passer la musique\n"
                  "`/volume` - R√©gler le volume",
            inline=True
        )

        embed.set_footer(text="Utilisez /config pour modifier ces param√®tres")
        await interaction.followup.send(embed=embed, ephemeral=True)

    async def config_tickets(self, interaction: discord.Interaction, config: Dict[str, Any]):
        """Configuration du syst√®me de tickets"""
        embed = discord.Embed(
            title="üé´ Configuration - Syst√®me de Tickets",
            description="Configurez le syst√®me de support par tickets",
            color=0x2ecc71,
            timestamp=datetime.datetime.now()
        )

        status = "üü¢ Activ√©" if config.get("enabled", False) else "üî¥ D√©sactiv√©"
        embed.add_field(
            name="üìä Statut",
            value=status,
            inline=True
        )

        ticket_category = config.get("ticket_category_id")
        embed.add_field(
            name="üìÅ Cat√©gorie Tickets",
            value=f"<#{ticket_category}>" if ticket_category else "‚ùå Non configur√©e",
            inline=True
        )

        embed.add_field(
            name="‚öôÔ∏è Configuration",
            value=f"**Auto-Close :** `{config.get('auto_close', '24h inactivit√©')}`\n"
                  f"**Max par utilisateur :** `{config.get('max_tickets', 3)}`\n"
                  f"**Support Role :** `{config.get('support_role', 'Non d√©fini')}`\n"
                  f"**Logs Channel :** `{config.get('log_channel', 'Non d√©fini')}`",
            inline=False
        )

        embed.add_field(
            name="üìã Fonctionnalit√©s",
            value="‚úÖ Cr√©ation tickets automatique\n"
                  "‚úÖ Syst√®me de permissions\n"
                  "‚úÖ Fermeture avec transcription\n"
                  "‚úÖ Support multi-cat√©gories\n"
                  "‚úÖ Panel de contr√¥le\n"
                  "‚úÖ Statistiques tickets",
            inline=True
        )

        embed.set_footer(text="Utilisez /config pour modifier ces param√®tres")
        await interaction.followup.send(embed=embed, ephemeral=True)

    async def config_polls(self, interaction: discord.Interaction, config: Dict[str, Any]):
        """Configuration du syst√®me de sondages"""
        embed = discord.Embed(
            title="üìä Configuration - Syst√®me de Sondages",
            description="Configurez les sondages et votes",
            color=0xf39c12,
            timestamp=datetime.datetime.now()
        )

        status = "üü¢ Activ√©" if config.get("enabled", True) else "üî¥ D√©sactiv√©"
        embed.add_field(
            name="üìä Statut",
            value=status,
            inline=True
        )

        embed.add_field(
            name="‚öôÔ∏è Param√®tres",
            value=f"**Dur√©e maximale :** `{config.get('max_duration', '7 jours')}`\n"
                  f"**Options max :** `{config.get('max_options', 10)}`\n"
                  f"**Vote anonyme :** `{config.get('anonymous_voting', 'Autoris√©')}`\n"
                  f"**R√©sultats temps r√©el :** `{config.get('live_results', 'Activ√©s')}`",
            inline=True
        )

        embed.add_field(
            name="üìã Types de Sondages",
            value="‚úÖ Sondages simples (Oui/Non)\n"
                  "‚úÖ Sondages √† choix multiple\n"
                  "‚úÖ Sondages avec images\n"
                  "‚úÖ Votes avec r√©actions\n"
                  "‚úÖ Sondages programm√©s\n"
                  "‚úÖ R√©sultats automatiques",
            inline=False
        )

        embed.add_field(
            name="üéÆ Commandes",
            value="`/poll create` - Cr√©er un sondage\n"
                  "`/poll results` - Voir r√©sultats\n"
                  "`/poll close` - Fermer sondage",
            inline=True
        )

        embed.set_footer(text="Utilisez /config pour modifier ces param√®tres")
        await interaction.followup.send(embed=embed, ephemeral=True)

    async def config_reaction_roles(self, interaction: discord.Interaction, config: Dict[str, Any]):
        """Configuration du syst√®me de r√¥les √† r√©action"""
        embed = discord.Embed(
            title="‚ö° Configuration - R√¥les √† R√©action",
            description="Configurez l'attribution de r√¥les par r√©action",
            color=0xe91e63,
            timestamp=datetime.datetime.now()
        )

        status = "üü¢ Activ√©" if config.get("enabled", True) else "üî¥ D√©sactiv√©"
        embed.add_field(
            name="üìä Statut",
            value=status,
            inline=True
        )

        embed.add_field(
            name="‚öôÔ∏è Configuration",
            value=f"**Panels actifs :** `{len(config.get('panels', []))}`\n"
                  f"**R√¥les configur√©s :** `{len(config.get('role_mappings', {}))}`\n"
                  f"**Mode exclusif :** `{config.get('exclusive_mode', 'D√©sactiv√©')}`\n"
                  f"**Auto-remove :** `{config.get('auto_remove', 'Activ√©')}`",
            inline=True
        )

        embed.add_field(
            name="üìã Fonctionnalit√©s",
            value="‚úÖ Panels de r√¥les personnalis√©s\n"
                  "‚úÖ R√¥les multiples par r√©action\n"
                  "‚úÖ Mode exclusif (1 r√¥le max)\n"
                  "‚úÖ Auto-suppression des r√¥les\n"
                  "‚úÖ √âmojis personnalis√©s\n"
                  "‚úÖ V√©rification de permissions",
            inline=False
        )

        embed.add_field(
            name="üéõÔ∏è Gestion",
            value="`/reactionrole setup` - Cr√©er panel\n"
                  "`/reactionrole add` - Ajouter r√¥le\n"
                  "`/reactionrole remove` - Supprimer",
            inline=True
        )

        embed.set_footer(text="Utilisez /config pour modifier ces param√®tres")
        await interaction.followup.send(embed=embed, ephemeral=True)

    async def config_welcome(self, interaction: discord.Interaction, config: Dict[str, Any]):
        """Configuration du syst√®me de bienvenue"""
        embed = discord.Embed(
            title="üëã Configuration - Messages de Bienvenue",
            description="Configurez l'accueil des nouveaux membres",
            color=0x00ff00,
            timestamp=datetime.datetime.now()
        )

        status = "üü¢ Activ√©" if config.get("enabled", False) else "üî¥ D√©sactiv√©"
        embed.add_field(
            name="üìä Statut",
            value=status,
            inline=True
        )

        welcome_channel = config.get("welcome_channel_id")
        embed.add_field(
            name="üìç Canal d'Accueil",
            value=f"<#{welcome_channel}>" if welcome_channel else "‚ùå Non configur√©",
            inline=True
        )

        embed.add_field(
            name="‚öôÔ∏è Param√®tres",
            value=f"**Message personnalis√© :** `{config.get('custom_message', 'Par d√©faut')}`\n"
                  f"**R√¥le automatique :** `{config.get('auto_role', 'Aucun')}`\n"
                  f"**Image de bienvenue :** `{config.get('welcome_image', 'D√©sactiv√©e')}`\n"
                  f"**DM priv√© :** `{config.get('private_welcome', 'D√©sactiv√©')}`",
            inline=False
        )

        embed.add_field(
            name="üìã Variables Disponibles",
            value="`{user}` - Mention du membre\n"
                  "`{username}` - Nom d'utilisateur\n"
                  "`{server}` - Nom du serveur\n"
                  "`{member_count}` - Nombre de membres",
            inline=True
        )

        embed.add_field(
            name="‚ú® Fonctionnalit√©s",
            value="‚úÖ Messages personnalis√©s\n"
                  "‚úÖ Images de bienvenue auto\n"
                  "‚úÖ R√¥les automatiques\n"
                  "‚úÖ Messages de d√©part\n"
                  "‚úÖ DM de bienvenue\n"
                  "‚úÖ Embed personnalisable",
            inline=True
        )

        embed.set_footer(text="Utilisez /config pour modifier ces param√®tres")
        await interaction.followup.send(embed=embed, ephemeral=True)

    async def config_hunt_royal(self, interaction: discord.Interaction, config: Dict[str, Any]):
        """Configuration du syst√®me Hunt Royal"""
        embed = discord.Embed(
            title="üèπ Configuration - Hunt Royal Integration",
            description="Configurez l'int√©gration Hunt Royal",
            color=0x8b4513,
            timestamp=datetime.datetime.now()
        )

        status = "üü¢ Activ√©" if config.get("enabled", True) else "üî¥ D√©sactiv√©"
        embed.add_field(
            name="üìä Statut",
            value=status,
            inline=True
        )

        embed.add_field(
            name="üéÆ Int√©gration",
            value=f"**API Status :** `{config.get('api_status', 'Connect√©')}`\n"
                  f"**Auto-Sync :** `{config.get('auto_sync', 'Activ√©')}`\n"
                  f"**Notifications :** `{config.get('notifications', 'Activ√©es')}`\n"
                  f"**R√©gion d√©faut :** `{config.get('default_region', 'Global')}`",
            inline=True
        )

        embed.add_field(
            name="üìã Fonctionnalit√©s",
            value="‚úÖ Liens de comptes Hunt Royal\n"
                  "‚úÖ Statistiques temps r√©el\n"
                  "‚úÖ Classements serveur\n"
                  "‚úÖ √âv√©nements Hunt Royal\n"
                  "‚úÖ Authentification s√©curis√©e\n"
                  "‚úÖ Profils d√©taill√©s",
            inline=False
        )

        embed.add_field(
            name="üéØ Commandes Hunt",
            value="`/hunt link` - Lier compte Hunt\n"
                  "`/hunt profile` - Voir profil\n"
                  "`/hunt stats` - Statistiques\n"
                  "`/hunt leaderboard` - Classement",
            inline=True
        )

        embed.set_footer(text="Utilisez /config pour modifier ces param√®tres")
        await interaction.followup.send(embed=embed, ephemeral=True)

async def setup(bot):
    await bot.add_cog(ArsenalConfigSystem(bot))
    
    # Ajouter les commandes individuelles
    bot.tree.add_command(create_poll)
    bot.tree.add_command(suggest)
    bot.tree.add_command(level_command)
    
    print("‚úÖ [Arsenal Config] Syst√®me de configuration complet charg√©")
    print("‚úÖ [Commands] Poll, Suggest, Level ajout√©es")
